{% extends 'base.html' %}

{% block body %}
 <!-- main content area start -->
 <div class="main-content ">
  <!-- header area start -->
  <div class="header-area">
      <div class="row align-items-center">
          <!-- nav and search button -->
          <div class="col-md-6 col-sm-8 clearfix">
               
              <div class="search-box pull-left logo">
                 <img src="{{ url_for('static', filename='assets/images/icon/logo.png') }}" alt="Logo" width="250">
                 <a href="https://design4green.org/"><img src="{{ url_for('static', filename='assets/images/icon/design4GreenLogo1.png') }}" alt="Logo" width="250"></a>
              </div>
          </div>
          <!-- profile info & task notification -->
          <div class="col-md-6 col-sm-4 clearfix">
              <ul class="notification-area pull-right">
                  <li id="full-view"><i class="ti-fullscreen"></i></li>
                  <li id="full-view-exit"><i class="ti-zoom-out"></i></li>
                  <li class="dropdown">
                      <a href="https://www.isit-academy.org/" target="_blank"><i class="fa fa-book"><span>IIST ACADEMY</span></i></a>                                 
                  </li>

                   <li class="dropdown">
                      <a href="mailto:fragilitenumerique@institutnr.org"><i class="fa fa-envelope-o" ></i></a>                                 
                  </li>
                  <li class="dropdown">
                      <a href="https://www.linkedin.com/company/institutnr" target="_blank"><i class="fa fa-linkedin"></i></a>                                 
                  </li> 
              </ul>
          </div>
      </div>
  </div>
  <!-- header area end -->
  <!-- page title area start -->
  <div class="page-title-area">
      <div class="row align-items-center">
          <div class="col-sm-12 p-2">
              <div class="breadcrumbs-area clearfix">
                  <h4 class="page-title pull-left">Filters :</h4>
                  <div class="row">
                      <div class="form-group col-md-3">
                          <label for="inputRegion">Region</label>
                          <select id="inputRegion" class="form-control">
                            <option>ALL</option>
                            {% for user in req["region"] %}
                            <option value="{{user}}">{{user}}</option>
                           {% endfor %}
                              
                            </select>
                      </div>
                      <div class="form-group col-md-3">
                          <label for="inputDepartment">Department</label>
                          <select id="inputDepartment" class="form-control" disabled>
                              <option value="ALL">ALL</option>
                                
                            </select>
                      </div>
                      <div class="form-group col-md-3">
                          <label for="inputInterCommunalities">Intercommunalities</label>
                          <select id="inputInterCommunalities" class="form-control" disabled>
                              <option value="ALL">ALL</option>

                            </select>
                      </div>
                      <div class="form-group col-md-3">
                          <label for="inputCommune">Commune</label>
                          <select id="inputCommune" class="form-control" disabled>
                              <option value="ALL">ALL</option> 
                            </select>
                      </div>
                      <div class="form-group col-md-3">
                          <label for="inputChoice">choix de point références</label>
                          <select id="inputChoice" class="form-control">
                            <option value="Region" selected>Region</option>
                            <option value="Department">Department</option>
                            <option value="Intercommunalities">Intercommunalities</option>
                          </select>
                      </div>
                      
                      <div class="form-group col-md-3">
                          <label for="inputChoice">données_infra_communales</label>
                          <select id="inputDonnes" class="form-control">
                              <option value="Non" selected>Non</option>
                              <option value="Oui">Oui</option> 
                          </select>
                      </div>
                  </div>  
              
              </div>
          </div>
          
      </div>
  </div>
  <!-- page title area end -->
   
  <div class="main-content-inner">
      <div class="row">
        <div class="col-4 mt-5">
            <div class="row">
                <div id='map' style='width: 95%; height:300px;'></div><br/><br/>
              </div>
              <script>
                var data={{data|tojson|safe}};  
                var longitude, latitude;
                 
                    latitude=0.0;
                    longitude=0.0
                  for (d in data['Final_result'])
                  {
                    latitude= data['Final_result'][d]["geo_points_lat"];
                    longitude=data['Final_result'][d]["geo_points_lon"]; 
                  }
                  if(latitude!="0.0")
                  display_map(longitude, latitude);
                  else
                  console.log("Wrong lat &lon ");
                 
               
                function display_map(longitude, latitude) {
                  mapboxgl.accessToken = "{{ mapbox_access_token }}"
                  var map = new mapboxgl.Map({
                  container: 'map',
                  style: 'mapbox://styles/mapbox/satellite-streets-v10',
                  center: [longitude,latitude],
                  zoom: 16,
                  bearing: -17.6,
                  pitch:45
                
                  });
                 
                  map.addControl(new mapboxgl.FullscreenControl());
                 
                  var marker = new mapboxgl.Marker()
                      .setLngLat([longitude,latitude])
                      .addTo(map);
                   
                    var nav = new mapboxgl.NavigationControl();
                      map.addControl(nav, 'top-left');
                    
                    map.addControl(new mapboxgl.GeolocateControl({
                        positionOptions: {
                            enableHighAccuracy: false
                        },
                      trackUserLocation: false
                  }));
                    
                  map.on('load', function() {
                      
                      var layers = map.getStyle().layers;
                      var labelLayerId;
                      for (var i = 0; i < layers.length; i++) {
                          if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
                              labelLayerId = layers[i].id;
                              break;
                          }
                      }
                      map.addLayer({
                          'id': '3d-buildings',
                          'source': 'composite',
                          'source-layer': 'building',
                          'filter': ['==', 'extrude', 'true'],
                          'type': 'fill-extrusion',
                          'minzoom': 15,
                          'paint': {
                              'fill-extrusion-color': '#aaa',
                             
                              'fill-extrusion-height': [
                                  "interpolate", ["linear"], ["zoom"],
                                  15, 0,
                                  15.05, ["get", "height"]
                              ],
                              'fill-extrusion-base': [
                                  "interpolate", ["linear"], ["zoom"],
                                  15, 0,
                                  15.05, ["get", "min_height"]
                              ],
                              'fill-extrusion-opacity': .6
                          }
                      }, labelLayerId);
                  });
                }
                display_map();
              
              </script>
          </div>
           
          <!-- Dark table start -->
          <div class="col-8 mt-5">
              <div class="card">
                  <div class="card-body">
                      <h4 class="header-title">Indice de Fragilite Numerique </h4>
                      <div class="data-tables datatable-dark">
                           <table id="dataTable3" class="stripe row-border order-column" style="width:100%">
                            <thead>
                              <tr>
                                <th>Nom Com</th>
                                <th>Code Iris</th>
                                <th>Rank of ScoreGlobal</th>
                                <th>Nom Iris</th>
                                <th>Population</th>
                                <th>Score Global</th>
                                <th>Acces Aux_interfaces_numeriques_intercommunalite</th>
                                <th>Access Al_information_intercommunalite</th>
                                <th>competences_administative_intercommunalite</th>
                                <th>competence_numeriques_intercommunalite</th>
                                <th>global_access_intercommunalite</th>
                                <th>global_competence_intercommunalite</th>
                              </tr>
                            </thead>
                          <tbody> 
                            {% for user in data['Final_result'] %} 
                            <tr>
                              <td>{{user['Nom Com']}}</td>
                              <td>{{user['Code Iris']}}</td>
                              <td>{{user['Rank of ScoreGlobal']}}</td>
                              <td>{{user['Nom Iris']}}</td>
                              
                              <td>{{user['Population']}}</td>
                              <td>{{user['Score Global']}}</td>
                              <td>{{user['Acces Aux_interfaces_numeriques_intercommunalite']}}</td>
                              <td>{{user['Access Al_information_intercommunalite']}}</td>
                              <td>{{user['competences_administative_intercommunalite']}}</td>
                              <td>{{user['competence_numeriques_intercommunalite']}}</td>
                              <td>{{user['global_access_intercommunalite']}}</td>
                              <td>{{user['global_competence_intercommunalite']}}</td>                             
                            </tr>
                            {% endfor %}
                          </tbody>
                      </table>

                           
                      </div>
                  </div>
              </div>
          </div>
          <!-- Dark table end -->
      </div>
  </div>
</div>
</div> 
<!-- main content area end -->

{% endblock %}